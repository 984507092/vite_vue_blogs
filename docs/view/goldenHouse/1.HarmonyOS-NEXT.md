# 鸿蒙next

## ArkUI基础组件

#### 文本

```tsx
1.基础用法
Text('小说简介').fontSize(32).width('100%').fontWeight(FontWeight.Bold)

2.多行溢出省略号
Text('鸿蒙方舟UI（ArkUI）是HarmonyOS操作系统中新一代的声明式UI框架，它提供了一套完整的UI开发解决方案，旨在帮助开发者以更简洁、更自然的方式开发高性能的应用界面。ArkUI框架支持多种组件，包括基础组件如文本显示、图片显示、按键交互等，同时也提供了支持视频播放能力的媒体组件。此外，ArkUI还提供了布局计算、动画能力、UI交互、绘制能力以及平台API通道等核心功能'  )
      .fontSize(20)
        .fontColor(Color.Gray)
        .textOverflow({overflow:TextOverflow.Ellipsis})//溢出显式省略号
        .maxLines(2)//最多占俩行
3.使用span给文本设置不同效果
   Text(){
          Span('我已阅读并同意')
          Span('《京东隐私政策》').fontColor(Color.Blue)
          Span('《京东用户服务协议》').fontColor(Color.Blue)
          Span('未注册的手机号将自动创建京东账号')
        }
        .fontSize(12)
        .fontColor('#666') 
```

#### 图片

```tsx
1.加载网络图片
Image('https://www.itheima.com/images/logo.png').height(50)

2.加载本地图片，通过$r读取
 Image($r('app.media.background')).height(50)

3.svg图片,可以设置颜色，放大不失真
   Image($r('app.media.dianliang'))
       .height(50)
       .fillColor(Color.Pink)//图片设置颜色
4.常用属性
  Image($r('app.media.flower'))
        .interpolation(ImageInterpolation.High)//减轻图片出现的锯齿问题
        .objectFit(ImageFit.Auto)//图片缩放
        .renderMode(ImageRenderMode.Template)//设置黑白
        .objectRepeat(ImageRepeat.XY)//重复
    }
```

#### 输入框

TextInput有5种可选类型，分别为Normal基本输入模式、Password密码输入模式、Email邮箱地址输入模式、Number纯数字输入模式、PhoneNumber电话号码输入模式，通过type属性进行设置

```tsx
@Entry
@Component
struct Index {
  @State message: string = 'Hello xxm';
  build() {
    Column({space:10}) {//space 元素相隔
      Row(){
        Image('https://www.itheima.com/images/logo.png').height(50)
      }.width('100%')
      Row(){
        TextInput({
          placeholder:'请输入用户名'  //输入提示
        }).type(InputType.Normal)//输入框类型
      }
      Row(){
        TextInput({
          placeholder:'请输入密码'
        }).type(InputType.Password)
      }
  }
}


```

#### 按钮

```tsx
1.基础使用
  //stateEffect点击默认高亮状态
  button('登录',{stateEffect:false}).width(200).fontColor(Color.Pink).fontSize(24)

2.按钮禁用
Button('click').enabled(false)

3.按钮类型
Button有三种可选类型，分别为Capsule（胶囊类型）、Circle（圆形按钮）和Normal（普通按钮），通过type进行设置

4.使用toggle实现按钮
 Toggle({type:ToggleType.Button,isOn:false}){Text('按钮')}
        .selectedColor(Color.Pink).onChange((e)=>{
        console.log(e.toString())
      })
```

#### 弹窗提示

```tsx
1.基础
AlertDialog.show({
  title:'修改',
  message:"ok"
})

2.确认取消按钮
       AlertDialog.show(
                        {
                          title: '温馨提示',
                          message: '确定吗?',
                          autoCancel: true,
                          alignment: DialogAlignment.Center,
                          gridCount: 4,
                          offset: { dx: 0, dy: -20 },
                          primaryButton: {
                            value: '取消',
                            action: () => {
                            }
                          },
                          secondaryButton: {
                            value: '确定',
                            action:async  () => {
                            }
                          }
                        }
                      )
```

#### 多选框

```tsx
CheckboxGroup({group:'hobby'}).onChange((e)=>{
  console.log(JSON.stringify(e))
})
Text('全选/全不选')
Row(){
  Row(){
    Checkbox({group:'hobby',name:'01'})
    Text('篮球')
  }
  Row(){
    Checkbox({group:'hobby',name:'02'})
    Text('乒乓球')
  }
  Row(){
    Checkbox({group:'hobby',name:'03'})
    Text('足球')
  }
}
```

#### 单选框

```tsx
Row(){
  Radio({group:'sex',value:"男"}).onChange((val)=>{//val返回一个布尔值，选中true，反之false
   val && console.log('选中性别男')
  })
  Text('男')
}
Row(){
  Radio({group:'sex',value:"女"}).onChange((val)=>{
    val && console.log('选中性别女')
  })
  Text('女')
}
```

#### select下拉

```tsx
    Select([
            { value: '轻度清洁' },
            { value: '中度清洁' },
            { value: '深度清洁'}
          ])
            .font({size:14})
            .selected(0)
            .value('轻度清洁')
            .onSelect((e)=>{
            console.log(e.toString())
          })
```

#### 开关

```tsx
Toggle({type:ToggleType.Switch,isOn:false}).selectedColor(Color.Pink).onChange((e)=>{
  console.log(e.toString())
})
```

#### 加载效果

```tsx
@Entry
@Component
struct TextIndex {
  @State isShow:boolean=false
  handleClick(){
    this.isShow=true
    setTimeout(()=>{
      this.isShow=false
    },5000)
  }
  build() {
    Column() {
  if(this.isShow){
    LoadingProgress().width(200).height(200).color('#888')
  }
  Button('请求').onClick(()=>{this.handleClick()})
    }
    .height('100%')
    .width('100%')
  }
}
```

#### 日期选择器

```tsx
   private selectTime: Date = new Date()
   DatePickerDialog.show({
                    start:new Date('2024-1- 1'),
                    end:new Date('2024-12-30'),
                    selected: this.selectTime,
                    onAccept:(e)=>{
                   this.date=`${e.year}-${e.month+1}-${e.day}`
                    }
                  })
```

#### 时间选择器

```tsx
 private selectTime: Date = new Date()

TimePickerDialog.show({
  selected: this.selectTime,
  onAccept:(e)=>{
   this.time=`${e.hour}:${e.minute}`
  }
})
```

#### 边框

```tsx
1.基础使用   
  Text(this.message).fontSize(25)
          .border({
            width:5,//边框大小
            color:Color.Pink,//边框颜色
            style:BorderStyle.Dotted//边框样式
          })
    ..borderRadius(10)//设置圆角

2.设置各边
Text(this.message).fontSize(25)
          .border({
          width:{left:1,right:2,top:3,bottom:4},//设置各边宽度
          color:{left:Color.Pink,right:Color.Blue,top:Color.Orange,bottom:Color.Green},//各边颜色
          style:{
            left:BorderStyle.Dashed,//虚线
            right:BorderStyle.Solid,//实线
            top:BorderStyle.Dotted//点线
          }
        .borderRadius({
            topLeft:10,//左上
            topRight:20,//右上
            bottomLeft:30,//左下
            bottomRight:40//右下
          })
    
   3.正圆头像
     Image($r('app.media.cat')).height(100).width(100).borderRadius(50)

   4.胶囊按钮
   Text('一只猫')
          .backgroundColor(Color.Pink)
          .height(40)
          .width(100)
          .textAlign(TextAlign.Center)
          .borderRadius(20)//设置成高度一半
```

#### 背景

```tsx
1.   
      Text('')
          .width('300vp')
          .height('200vp')
          .fontSize(24)
          .fontColor(Color.Pink)
          .backgroundImage($r("app.media.flower"))//背景图
          .backgroundImagePosition({//背景定位，单位vp
            x:'120vp',
            y:'70vp'
          }) 
          .backgroundImageSize({//设置宽高值
            width:'300',
            height:200
          })
2.
      Text('')
          .width('300vp')
          .height('200vp')
          .fontSize(24)
          .fontColor(Color.Pink)
          .backgroundImage($r("app.media.cat"))
          .backgroundImagePosition(Alignment.Center)//使用枚举Alignment
          .backgroundImageSize(ImageSize.Cover)
      //使用枚举ImageSize  Cover完全覆盖 Contain等比例缩放到宽或高与组件一致
```

#### 多态样式

```tsx
Button('按钮').stateStyles({
  focused: {//按钮聚焦
    .backgroundColor(Color.Pink) 
  },
  pressed: {//按钮按下
    .backgroundColor(Color.Black)
  },
  normal: {//默认状态
    .backgroundColor(Color.Yellow)
  }
})
```

#### 分割线

```tsx
@Entry
@Component
struct TextIndex {
  @State message: string = 'Hello xxm';

  build() {
    Column() {
      Text(this.message)
        .fontSize(35)
        .fontWeight(FontWeight.Bold)
      Divider().color('#888').height(20)
      TextArea({placeholder:"请输入内容"}).height(100)
    }
    .height('100%')
    .width('100%')
  }
}
```

#### 线性布局

##### Colum

```tsx
Column({space:10}) {
      Row(){
        Image($r('app.media.cat')).height(100).width(100).borderRadius(50)
      }
      Row(){
        Text('猫哥')
          .backgroundColor(Color.Pink)
          .height(40)
          .width(100)
          .textAlign(TextAlign.Center)
          .borderRadius(20)
      }
      Row(){
        Text('')
          .width('300vp')
          .height('200vp')
          .fontSize(24)
          .fontColor(Color.Pink)
          .backgroundImage($r("app.media.cat"))
          .backgroundImagePosition(Alignment.Center)
          .backgroundImageSize(ImageSize.Cover)
          .borderRadius(10)
      }
    }
    .justifyContent(FlexAlign.Center)//设置主轴元素排布，主轴竖直
    .alignItems(HorizontalAlign.Center)//设置副轴元素排布
```

##### Row

```tsx
    Row({space:10}){
        Text('查看图片').fontSize(20)
        Text('切换图片').fontSize(20)
        Text('删除图片').fontSize(20)
      }
      .justifyContent(FlexAlign.Center)//设置主轴元素排布，主轴水平
      .alignItems(HorizontalAlign.Center)//设置副轴元素排布
```

#### 自适应伸缩

layoutWeight按权重分配主轴空间

```ts
 Column(){
       Row(){
         Column(){
           Row(){
             Text('玩一玩')
               .fontSize(30)
               .fontStyle(FontStyle.Italic)
               .fontWeight(FontWeight.Bold)
               .margin({left:10})
           }
           Row({space:5}){
             Text('签到兑换').fontSize(18).fontColor(Color.Gray)
             Text('超多大奖').fontSize(18).fontColor(Color.Gray)
             Text('超好玩').fontSize(18).fontColor(Color.Gray)
           }.padding(10)
         }.alignItems(HorizontalAlign.Start).layoutWeight(2)
         Column(){
           Row({space:15}){
             Image($r('app.media.tree')).height(80).backgroundColor('#54888888')
             Text('>').fontSize(30).width(45).fontColor(Color.Gray)
           }
         }.layoutWeight(1)
       }
       .justifyContent(FlexAlign.SpaceBetween)
       .margin({top:10})
       .backgroundColor('#54888888')
       .width('100%')
       .height(100)
       .borderRadius(10)
     }.padding(10)
```

#### Flex布局

```tsx
@Entry
@Component
struct Flexs {
  @State message: string = 'Hello xxm';

  build() {
    Column() {
      Text('阶段选择').fontSize(30).fontWeight(FontWeight.Bold).width('100%')
    Flex({
      wrap:FlexWrap.Wrap,//换行
      direction:FlexDirection.Row,//设置主轴
      justifyContent:FlexAlign.Start,//设置主轴元素排布
      alignItems:ItemAlign.Center//设置副轴元素排布
    }){
      Text('ArkUI').fontSize(20).padding(15).backgroundColor('#f1f1f1').margin(5)
      Text('ArkTs').fontSize(20).padding(15).backgroundColor('#f1f1f1').margin(5)
      Text('界面开发').fontSize(20).padding(15).backgroundColor('#f1f1f1').margin(5)
      Text('系统能力').fontSize(20).padding(15).backgroundColor('#f1f1f1').margin(5)
      Text('权限控制').fontSize(20).padding(15).backgroundColor('#f1f1f1').margin(5)
      Text('元服务').fontSize(20).padding(15).backgroundColor('#f1f1f1').margin(5)
    }
    }
  }
}
```

#### 层叠布局

Stack

```tsx
@Entry
@Component
struct Stacks {
  @State message: string = 'Hello xxm';

  build() {
    Column() {
    Column(){
      Stack({
          alignContent:Alignment.Bottom//排布向下
      }){
        Image($r('app.media.stack')).borderRadius({topLeft:15,topRight:15})
        Row(){
          Row({space:10}){
            Image($r('app.media.bz_play')).height(25).fillColor(Color.White)
            Text('288万').fontColor(Color.White)
          }.margin({right:10})
          Row({space:10}){
            Image($r('app.media.bz_msg')).height(20).fillColor(Color.White)
            Text('288万').fontColor(Color.White)
          }
          Blank()//占剩余空间
          Text('4：33').fontColor(Color.White)
        }
        .padding({left:10,right:5})
        .justifyContent(FlexAlign.SpaceBetween)
        .alignItems(VerticalAlign.Center)
        .width('100%')
      }.width('100%')
      .height(200)
      .backgroundColor(Color.Gray)

      Column(){}
      Text('【凤凰传奇新歌】欢迎来到国风统治区：唢呐一响神曲《铁衣流派推广曲》')
        .fontSize(18)
        .maxLines(2)
        .textOverflow({overflow:TextOverflow.Ellipsis})
        .margin({top:10})

      Row(){
        Text('19万点赞').width(70).height(25).backgroundColor(Color.Orange).fontSize(16)
        Image($r('app.media.bz_more')).height(20)
      }
      .justifyContent(FlexAlign.SpaceBetween)
      .width('100%')
      .padding(10)
    }
    .height(300)
    .backgroundColor(Color.White)
    .borderRadius({bottomLeft:10,bottomRight:10})
    }
    .height('100%')
    .width('100%')
    .backgroundColor(Color.Gray)
    .padding(20)
  }
}
```

#### 绝对定位和层级

```tsx
@Entry
@Component
struct Zindex {
  build() {
    Column() {
      Row(){
        Text('VIP')
          .fontStyle(FontStyle.Italic)
          .fontSize(24)
          .fontColor(Color.White)
          .fontWeight(FontWeight.Bold)
          .backgroundColor(Color.Orange)
          .width(55)
          .textAlign(TextAlign.Center)
          .borderRadius({
            topLeft:10,
            bottomRight:10
          })
          .position({//设置定位
            top:0
          })
          .zIndex(2)//设置层级
        Image($r('app.media.dog'))
          .height(300)
          .borderRadius(10)

        Row(){
          Image($r('app.media.music')).height(25).backgroundColor('#5db7e3').fillColor(Color.White).borderRadius(25).padding(3)
          Text('飞狗MOCO').fontSize(20)

        }
        .backgroundColor(Color.White).
        width('100%').
        height(40)
        .justifyContent(FlexAlign.Center)

        .width('210')
        .position({
          bottom:-25
        })
      }
      .backgroundColor(Color.White)
      .borderRadius(10)
      .height(300)
      .width(210)
    }
    .backgroundColor(Color.Gray)
    .height('100%')
    .width('100%')
  }
}
```

#### 事件绑定

```tsx
1.基础使用
Text(this.message)
        .fontSize(35)
        .onClick(()=>{
          AlertDialog.show({
            message:'你好'
          })
        })

2.抽离

struct Index {
  @State message: string = 'Hello World';
  hangleCick=()=>{
    console.log('111')
  }
  
  build() {
    Column() {
        Text('hello').onClick(this.hangleCick)
    }
  }
```

#### 条件渲染

```tsx
@Entry
@Component
struct ConditionalRenderingPage {
  @State isShow: boolean = true;

  build() {
  Column(){
    if(this.isShow){
      Row(){
        Text('显式')
      }
    }else{
      Row(){
        Text('隐藏')
      }
    }
Button('change').onClick(()=>{
  this.isShow=!this.isShow
})

  }
    .height('100%')
    .width('100%')
  }
}
```

#### ForEach遍历

```tsx
@Entry
@Component
struct ForEachPage {
  @State data: string[] = ['你不知道的vue','你不知道的js','你不知道的react'];

  build() {
    Column() {
    ForEach(this.data,(item:string,index:number)=>{
      Text(item)
    })
    }
    .height('100%')
    .width('100%')
  }
}
```

#### Grid网格布局

```tsx
1.基础用法:
  build() {
    Column() {
      Grid(){
      ForEach([1,2,3,4,5,6],(item:number)=>{
      GridItem(){
        Text(item.toString())
      }.backgroundColor(Color.Pink)
      })
      }
      .columnsTemplate('1fr 1fr 1fr')//三列
      .rowsTemplate('1fr 1fr')//俩行
      .columnsGap(10)//列间距
      .rowsGap(10)//行间距
      .width('100%')
      .height(300)
    }
    .height('100%')
    .width('100%')
  }
}  



  Grid(){
          ForEach(this.cardList,(item:cardList)=>{
            GridItem(){//每个放入一个GridItem
              Badge({//设置圆角
                count:item.count,//圆标数值
                position:BadgePosition.RightTop,//圆标位置
                style:{//装饰数值样式
                  badgeSize:20,
                  fontSize:16
                }
              }){
                Image($r(item.url)).height(120)
              }
            }
          })
        }.columnsTemplate('1fr 1fr 1fr ')//占几列
        .rowsTemplate('1fr 1fr')//占几行
        .height(300)
```

#### Swiper轮播

```tsx
1.基础使用  
Swiper(){
      Image($r("app.media.product1"))
      Image($r("app.media.product2"))
      Image($r("app.media.product3"))
    }
    .loop(true)//开启循环，自动回到第一页
    .autoPlay(true)//自动轮播
    .interval(1500)//切换时间
    .vertical(false)//是否纵向滑动
    .width('100%')
    .height(200)

2.定义指示器样式
    Swiper(){
      Image($r("app.media.product1"))
      Image($r("app.media.product2"))
      Image($r("app.media.product3"))
    }
    .indicator(
      // Indicator.digit()//数字
      Indicator.dot()//圆点
        .itemWidth(20)//默认宽
        .itemHeight(10)//默认高
        .color(Color.Gray)//默认颜色
        .selectedItemWidth(20)//选中宽
        .selectedItemHeight(10)//选中高
        .selectedColor(Color.White)//选中颜色
```

#### Scroll组件

设置溢出的子组件滚动，只支持一个子组件

```tsx
@Entry
@Component
struct ScrollPage {
  build() {
Column(){
  Scroll(){
    Column({space:10}) {
      ForEach(Array.from({length:10}),(item:string,index:number)=>{
        Text(`测试文本${index+1}`)
          .height(120)
          .width('100%')
          .backgroundColor(Color.Pink)
      })
    }
  }.width('100%')
  .height('100%')
  // .scrollable(ScrollDirection.Horizontal)//水平滑动
  .scrollable(ScrollDirection.Vertical)//竖直滑动
}
    .height('100%')
    .width('100%')
  }
}
```

滚动控制器、事件

```tsx
struct ScrollPage {
  myScroll:Scroller=new Scroller()
  build() {
Column(){
  Scroll(this.myScroll){
    Column({space:10}) {
      ForEach(Array.from({length:10}),(item:string,index:number)=>{
        Text(`测试文本${index+1}`)
          .height(120)
          .width('100%')
          .backgroundColor(Color.Pink)
      })
    }
  }.width('100%')
  .height('100%')
  .padding(30)
  .scrollable(ScrollDirection.Vertical)//竖直滑动
  .scrollBar(BarState.Off)//显式隐藏滚动条
    
  Button('返回顶部').margin(10).backgroundColor(Color.Pink).onClick(()=>{
    this.myScroll.scrollEdge(Edge.Top)//回到顶部
  })
  Button('获取滚动距离').margin(10).backgroundColor(Color.Pink).onClick(()=>{
    let y=this.myScroll.currentOffset().yOffset
    console.log(y.toString())
  })
}
    .height(400)
    .width('100%')
  }
}

事件
onScroll：滚动事件回调, 返回滚动时水平、竖直方向的偏移量。
onScrollEdge：滚动到边缘事件回调。
onScrollEnd：滚动停止事件回调。
```

#### Tab组件

基础使用

```tsx
@Entry
@Component
struct TabrPage {
  build() {
    Tabs({barPosition:BarPosition.End}){//设置tabNav位置
      TabContentrong(){//TabContentrong容器只能放一个组件
        Text('首页')
      }.tabBar('首页')

      TabContent(){
        Text('新闻中心')
      }.tabBar('新闻中心')

      TabContent(){
        Text('个人中心')
      }
      .tabBar('个人中心')
    }
    .vertical(false)//false水平，true垂直
    .scrollable(true)//允许手势切换
    .animationDuration(500)//动画过渡时间
    .barMode(BarMode.Scrollable)//Nav超出允许滚动
    .height('100%')
    .width('100%')
  }
}
```

自定义Tab

```tsx
@Entry
@Component
struct TabrPage {
  @State tabSelectIndex: number = 0//动态tabIndex
  @Builder
   tabBuild(icon:ResourceStr,selectIcon:ResourceStr,title:string,itemIndex:number){
  Column(){
    Image(this.tabSelectIndex===itemIndex? selectIcon:icon).height(40)
    Text(title).fontColor(this.tabSelectIndex===itemIndex? Color.Orange :Color.Black)
  }
}
  build() {
    Tabs({barPosition:BarPosition.End}){//设置tabNav位置
      TabContent(){
        Text('购物车')
      }
      .tabBar(this.tabBuild($r('app.media.ic_tabbar_icon_2'),$r('app.media.ic_tabbar_icon_2_selected'),'购物车',0))

      TabContent(){
        Text('个人中心')
      }
      .tabBar(this.tabBuild($r('app.media.ic_tabbar_icon_3'),$r('app.media.ic_tabbar_icon_3_selected'),'个人中心',1))

    }
    .vertical(false)//false水平，true垂直
    .scrollable(true)//允许手势切换
    .animationDuration(500)
    .height('100%')
    .width('100%')
    .onChange((index)=>{
      this.tabSelectIndex=index
    })
  }
}
```

#### List组件

```tsx
List(){
  ForEach(Array.from({length:10}),(item:string)=>{
    ListItem().width('100%').height(100).backgroundColor(Color.Pink).margin({top:10})
  })
}
.lanes(1,5)//列数，间距
.listDirection(Axis.Vertical)//主轴方向
.alignListItem(ListItemAlign.Center)
.scrollBar(BarState.Auto)//滚动条显式隐藏，自适应
.divider({strokeWidth:1,color:Color.Black})//分割线样式

```

#### 嵌套web网页

```ts
//module.json5

"pages": "$profile:main_pages",
"requestPermissions": [
  {
    "name": "ohos.permission.INTERNET"//访问网络
  }
],
    
 1.静态资源的网页，存放于resources/rawfile 
import { webview } from '@kit.ArkWeb';
@Entry
@Component
struct WebPage {
  @State message: string = 'Hello World';
  controller:webview.WebviewController=new webview.WebviewController()
  build() {
    Column(){
      Web({
        src:$rawfile('index.html'),
        controller:this.controller
      })

    }
    .height('100%')
    .width('100%')
  }
}

2.嵌入在线网页
import { webview } from '@kit.ArkWeb';

@Entry
@Component
struct WebPage {
  @State message: string = 'Hello World';
  controller:webview.WebviewController=new webview.WebviewController()
  build() {
    Column(){
      Web({
        src:"https://m.maizuo.com/v5/#/films/nowPlaying",
        controller:this.controller
      })

    }
    .height('100%')
    .width('100%')
  }
}

3.前进、后退、刷新、清除历史记录
 // 前进
 this.controller.forward()
 //后退
  this.controller.backward()
 //刷新
  this.controller.refresh()
  //清除历史记录
   this.controller.clearHistory()


4.执行静态资源js里的方法
     Button('执行js').onClick(()=>{
        this.controller.runJavaScript('getUserInfo()',(err,res)=>{
          if(!err){
            console.log('xxm'+res)
          }
        })
      })


5.注册js到静态资源js里
     Button('注入js').onClick(()=>{
      this.controller.registerJavaScriptProxy({
        setList:()=>JSON.stringify({name:'xxm'})
      },"winArts",['setList'])
      }
```

#### Video

```tsx
@Entry
@Component
struct ViewPage {
  @State message: string = 'Hello World';
   private  videoConterooler:VideoController=new VideoController()
  build() {
    Column() {
     Video({
       src:"https://vod.300hu.com/vod/product/bc111737-b426-43a5-ac07-9c1ec7a32e3e/1087_3000_1_578780c7a_f.mp4?source=1&h265=1088_2000_1_ed1698611_f.mp4",//网络资源
     // src:$rawfile('video (1).mp4'),//本地资源
       previewUri:'/images/product1.jpg',//预览海报
       controller:this.videoConterooler//控制器
     })
       .muted(false)//是否静音
       .height(200)
       .width('100%')
       .autoPlay(false)//自动播放
       .controls(false)//是否显式进度条
       .loop(true)//循环播放
        
   //控制器
  Row(){
        button('click').onClick(()=>{
            this.videoConterooler.pause()//暂停
            this.videoConterooler.start()//播放
            this.videoConterooler.stop()//回到0秒
           this.videoConterooler.setCurrentTime(this.time,SeekMode.Accurate)//快进10秒，精准模式
            this.time+=10
        })
    }
    }
    .height('100%')
    .width('100%')
  }
}
```

##

## ArkUI进阶

### 结构复用

##### @Extend

基于组件抽取样式，事件

```tsx
1.基本使用
@Extend(Text)
function isText(){
  .fontColor(Color.Pink)
  .fontSize(24)
}

2.传值，动态设置
@Extend(Text)
function isText(bgColor:ResourceColor,ftColor:ResourceColor,msg:string){
  .fontColor(ftColor)
  .backgroundColor(bgColor)
  .onClick(()=>{
    AlertDialog.show({
      message:msg
    })
  })
}
```

##### @Styles

抽取通用属性，事件

```tsx
1.全局
@Styles function  commonStyles(){
  .width(200)
  .height(100)
}

2.局部
  @Styles setBg(){
    .backgroundColor(this.bgColor)//局部可以使用组件内的state
    .width(200)
    .height(100)
  }

3.使用:
@Entry
@Component
struct Styles {
  @State bgColor: string = '#888';
  build() {
    Column() {
      Text('1').commonStyles()
      Text('2').setBg()
      Text('3').commonStyles()
    }
    .height('100%')
    .width('100%')
  }
  @Styles setBg(){
    .backgroundColor(this.bgColor)
    .width(200)
    .height(100)
  }
}

@Styles function  commonStyles(){
  .width(200)
  .height(100)

}
```

##### @Builder

自定义构建函数

```tsx
@Entry
@Component
struct Builders {
  build() {
    Column() {
      navItem($r('app.media.product1'),'西瓜')
      navItem($r('app.media.product2'),'蔬菜')
    }
    .height('100%')
    .width('100%')
  }
}
@Builder
function  navItem(icon:ResourceStr,textContent:string){
  Column(){
    Image(icon).height(200)
    Text(textContent)
  }
}
```

### 动画

#### 显式动画

使用animateTo组件

```tsx
 @Entry
@Component
struct AnimatePage {
  @State textWidth: number = 200;
  @State textHeight: number = 200;
  build() {
    Column() {
      Text('hello word')
        .fontWeight(FontWeight.Bold)
        .width(this.textWidth)
        .height(this.textHeight)
        .backgroundColor(Color.Pink)
        .textAlign(TextAlign.Center)

      Button('change').onClick(()=>{
        // 使用显式动画组件
        animateTo({
          duration:1000,//过渡时间
          curve:Curve.Ease//动画效果
        },()=>{//执行
          this.textWidth=260
          this.textHeight=260
        })
      })

    }
    .height('100%')
    .width('100%')
  }
}

```

#### 属性动画

使用animation属性

```tsx
@Entry
@Component
struct AnimatePage {
 @State textOpacity:number=1
  build() {
    Column() {
      Text('hello word')
        .fontWeight(FontWeight.Bold)
        .opacity(this.textOpacity)
        //设置属性动画
        .animation({
          duration:1000,
          curve:Curve.Linear
        })

      Button('change').onClick(()=>{
      this.textOpacity=0
      })
    }
    .height('100%')
    .width('100%')
  }
}
```

#### 组件内专场动画

使用transition和animateTo

```tsx
@Entry
@Component
struct AnimatePage {
  @State isShow:boolean=true
  build() {
    Column() {
      if(this.isShow){
        Text('hello word')
          .fontWeight(FontWeight.Bold)
          .width(100)
          .height(100)
          .backgroundColor(Color.Pink)
          //转场动画
          .transition({
            type:TransitionType.Insert,
            translate:{x:-100,y:0},
            opacity:0
          })
          .transition({
            type:TransitionType.Delete,
            translate:{x:-100,y:0},
            opacity:0
          })
      }

     Button('change').onClick(()=>{
     //使用animateTo控制显式隐藏
    animateTo({duration:500,curve:Curve.Linear},()=>{
      this.isShow=!this.isShow
    })
     })

    }
    .height('100%')
    .width('100%')
  }
}
```

#### 页面跳转动画

```tsx
1.
  pageTransition() {
      //滑动退出动画
    PageTransitionExit({duration:500,curve:Curve.Linear  }).slide(SlideEffect.Left)
      //滑动进入动画
    PageTransitionEnter({  duration:500,curve:Curve.Linear }).slide(SlideEffect.Left)
  }
2.
  pageTransition() {
      //平移退出动画
    PageTransitionExit({ duration:500,curve:Curve.Linear }).translate({ x: 0.0, y: 500.0 })
      //平移进入动画
    PageTransitionEnter({ duration:500,curve:Curve.Linear }).translate({ x: 0.0, y: 500.0 })

  }
  pageTransition() {
    //缩放退出动画
    PageTransitionExit({ duration:500,curve:Curve.Linear }).scale({ x: 0, y: 0})
    //缩放进入动画
    PageTransitionEnter({ duration:500,curve:Curve.Linear }).scale({ x: 0, y: 0 })
  }
```

### 组件化

#### 基本使用

```tsx
//子组件
@Component
export  struct  myComponent{
  build() {
  Row(){
    Text('我是自定义组件').fontColor(Color.Pink)
  }
  }
}

//index.ets
import {myComponent} from '../components/MyComponent'
@Entry
@Component
struct DiyComponent {
  build() {
    Column() {
      myComponent().height(500).backgroundColor(Color.Black)
    }
    .height('100%')
    .width('100%')
  }
}
```

#### 组件传值

成员变量可以被外部传入值覆盖，成员函数不能覆盖

```tsx
//父组件
import {myComponent} from '../components/MyComponent'
@Entry
@Component
struct DiyComponent {

  @State message: string = 'Hello xxm';

  build() {
    Column() {
      myComponent({title:'0点秒杀'}).padding(20)
      myComponent({title:'我的订单',more:'全部订单'}).padding(20)
    }
    .height('100%')
    .width('100%')
  }
}

//子组件
@Component
export  struct  myComponent{
  title:string='默认标题'//成员变量
  more:string='查看更多'//成员变量
  senList=()=>{}//成员变量
  sendDate(){}//成员函数
  build() {
  Column(){
    Row(){
      Text(this.title).fontSize(24).fontWeight(FontWeight.Bold)
      Text(this.more).fontSize(24).fontColor('#888')
    }
    .width('100%')
    .justifyContent(FlexAlign.SpaceBetween)
    Row(){
      Text('内容').fontSize(40).margin({top:100})
    }
  }
  .height(300)
  .backgroundColor('#ffdbd7d7')
  .padding(20)
  .borderRadius(10)
  }
}

```

#### 插槽BuilderParam

##### 尾随闭包

```tsx
//父组件
 myComponent({title:'0点秒杀'})
      {
        TextArea({placeholder:'请输入内容'}).height(100).margin({top:40})//传递给子组件
      }



//子组件
@Component
export  struct  myComponent{
  title:string='默认标题'
  more:string='查看更多'
  @BuilderParam contentBuild:()=>void=this.defaulContentBuild
  @Builder defaulContentBuil(){
  Text('默认内容')
  }
  build() {
  Column(){
    Row(){
      Text(this.title).fontSize(24).fontWeight(FontWeight.Bold)
      Text(this.more).fontSize(24).fontColor('#888')
    }
    .width('100%')
    .justifyContent(FlexAlign.SpaceBetween)
    Row(){
     this.contentBuild()
    }
  }
  .height(300)
  .backgroundColor('#ffdbd7d7')
  .padding(20)
  .borderRadius(10)
  }
}
```

##### 具名插槽

```tsx
//子组件
@Component
struct Components {
  @BuilderParam left:()=>void=this.leftBuild
    
  @Builder leftBuild(){
    Text('左')
  }
    
  @BuilderParam right:()=>void=this.rightBuild
  
  @Builder rightBuild(){
    Text('右')
  }
    
  @State title:string=''
  build() {
    Column() {
     Row(){
       this.left()
       Text(this.title)
       this.right()
     }.justifyContent(FlexAlign.SpaceBetween).width('100%')
    }
    .height('100%')
    .width('100%')
  }
}

//父组件
@Entry
@Component
struct BuilderPage {
  @Builder left(){
    Text('<').fontSize(20)
  }
  @Builder right(){
    Image($r('app.media.flower')).height(100)
  }
  build() {
    Column() {
      Components({left:this.left,right:this.right,title:'helloWord'})
    }
    .height('100%')
    .width('100%')
  }
}
```

#### @Watch监听器

```tsx
@Entry
@Component
struct Index {
 @Watch('handleCount') @State count: number = 0;//count变化对调用handleCount
  handleCount(){
    if(this.count===10){
    AlertDialog.show({
      title:'提示',
      message:'ok'
    })
    }
    }
  aboutToAppear(): void {
  setInterval(()=>{
    this.count++
  },1000)
  }

  build() {
    Column() {
  Text(this.count.toString()).fontSize(20)
    }
    .height('100%')
    .width('100%')
  }
}
```

### 状态通信

#### @State

```tsx
1.基础类型
@State message: string = 'Hello xxm';
Text(this.message)
        .fontSize(35)
        .onClick(()=>{
    this.message='你好 xxm'//message改变，触发render重渲染页面
        })

2.复杂类型，检测不到深层变化
  @State data: dataList = {
    name: 'xxm',
    age: 19,
    car:{name:'bmw'}
  }

  Text(this.data.car.name)
        .fontSize(35)
        .fontWeight(FontWeight.Bold)
  Button("change").onClick(() => {
      this.data.car={
          name:'Benz'
      }
      })
```

#### @prop单向数据流

```tsx
父组件
import Props from  '../components/Props'
@Entry
@Component
struct PropsPage {
  @State message: string = 'Hello xxm';
  change=(newVal:string)=>{
 this.message=newVal
    AlertDialog.show({
      title:'修改',
      message:"ok"
    })
  }

  build() {
    Column() {
     Props({title:this.message,changeMessage:this.change})
    }
    .height('100%')
    .width('100%')
  }
}

子组件
@Component
struct Props {
  @Prop title:string='' 父组件更新title，子组件随之更新
  changeMessage=(newVal:string)=>{}
  build() {
    Column() {
      Text(this.title).fontSize(24)
      Button('change').onClick(()=>{
        this.changeMessage('XXM')
      })
    }
    .height('100%')
    .width('100%')
  }
}
export  default  Props
```

#### @Link双向数据流

```tsx
父组件子组件任意一方修改，都会触发父组件子组件重新渲染更新

父组件
import LinkComponent from '../components/LinkComponent'
@Entry
@Component
struct LinkPage {
  @State count: number = 0;

  build() {
    Column() {
      Text(`父组件数据：${this.count.toString()}`)
        .fontSize(35)
        .fontWeight(FontWeight.Bold)
    Button('change').onClick(()=>{
    this.count++
    })
      LinkComponent({count:this.count})
    }
    .height('100%')
    .width('100%')
  }
}


子组件
@Component
struct LinkComponent {
  @Link count:number

  build() {
    Column() {
      Text(`子组件数据：${this.count.toString()}`)
        .fontSize(35)
        .fontWeight(FontWeight.Bold)
      Button('change').onClick(()=>{
    this.count--
      })
    }
    .height('100%')
    .width('100%')
  }
}
export  default LinkComponent
```

#### @Provide @Comsume 后代双向通信

```tsx
顶级组件
import  ComsumePage from '../components/ComsumePage'
@Entry
@Component
struct ProvidePage {
  @Provide title: string = 'Hello xxm';

  build() {
    Column() {
      Text(`顶级组件:${this.title}`)
      Button('changeName').onClick(()=>{
        this.title='xxm-1'
      })
     ComsumePage()
    }
    .height('100%')
    .width('100%')
  }
}

三级组件组件
@Component
struct injectPage{
  @Consume title:String
  build() {
   Column(){
     Text(`三级组件:${this.title}`)
     Button('changeName').onClick(()=>{
       this.title='xxm-3'
     })
   }
  }
}

二级组件
@Component
struct ComsumePage {
 @Consume title:string

  build() {
    Column() {
      Text(`二级组件:${this.title}`)
      Button('changeName').onClick(()=>{
        this.title='xxm-2'
      })
      injectPage()
    }
    .height('100%')
    .width('100%')
  }
}
export  default  ComsumePage
```

#### LocalStorage页面间共享状态

##### 局部与多个视图中共享

```tsx
1.局部
let para:Record<string,string>={'nameVal':'xxm'}
let storage:LocalStorage = new LocalStorage(para);
@Entry(storage)//传入
@Component
struct LoaclstorePages {
  @LocalStorageProp('nameVal') nameVal: string = '';
  build() {
    Column() {
      Text(this.nameVal)
    }
    .height('100%')
    .width('100%')
  }
    
2.多个视图，在EntryAbility.ets配置
  para:Record<string, number> = { 'PropA': 47 };
  storage: LocalStorage = new LocalStorage(this.para);
  onWindowStageCreate(windowStage: window.WindowStage): void {
  windowStage.loadContent("pages/LocalstorePage",this.storage, (err) => {...}
    
 视图使用：
let storage = LocalStorage.getShared()//通过LocalStorage.getShare获取，只在真机和模拟器有效
@Entry(storage)//传入视图
@Component
struct storagePage {
  @LocalStorageLink('PropA') PropA:number=0
  build() {
    Column() {
      Text(this.PropA.toString())
        .fontSize(35)
        .fontWeight(FontWeight.Bold)
    }
    .height('100%')
    .width('100%')
  }
```

##### LocalStorageProp

@LocalStorageProp装饰的变量和与LocalStorage中给定属性建立单向同步关系。

```tsx
let para:Record<string,string>={'nameVal':'xxm'}
let storage:LocalStorage = new LocalStorage(para);
@Entry(storage)//注入
@Component
struct LoaclstorePages {
  @LocalStorageProp('nameVal') nameVal: string = '';//单向
  build() {
    Column() {
      Text(this.nameVal)
      Button('click').onClick(()=>{this.nameVal='hello word'})//修改只更新当前页面的值
    }
    .height('100%')
    .width('100%')
  }
}
```

##### LocalStorageLink

@LocalStorageLink装饰的变量和在@Component中创建与LocalStorage中给定属性建立双向同步关系。

```ts
let para:Record<string,string>={'nameVal':'xxm'}
let storage:LocalStorage = new LocalStorage(para);
@Entry(storage)
@Component
struct LoaclstorePages {
  @LocalStorageLink('nameVal') nameVal: string = '';
  build() {
    Column() {
      Text(this.nameVal)
      Button('click').onClick(()=>{this.nameVal='hello word'})//改变内容，对应组件同步修改
    }
    .height('100%')
    .width('100%')
  }
}
```

#### AppStorage应用全局的UI状态存储

##### 创建

```ts
onWindowStageCreate(windowStage: window.WindowStage): void {
  AppStorage.setOrCreate('cityName','汕头')//创建
}
```

##### @StorageProp

```tsx
@Entry
@Component
struct AppStoragePage {
  @StorageProp ('cityName')  cityName:string=''//单向
  build() {
    Column() {
      Text(this.cityName)
        .fontSize(35)
        .fontWeight(FontWeight.Bold)
    }
    .height('100%')
    .width('100%')
  }
}
```

##### @StorageLink

```tsx
@Entry
@Component
struct AppStoragePage {
  @StorageLink ('cityName')  cityName:string=''//双向

  build() {
    Column() {
      Text(this.cityName)
        .fontSize(35)
        .fontWeight(FontWeight.Bold)
    }
    .height('100%')
    .width('100%')
  }
}
```

#### PersistentStorage持久化存储

基于AppStoragePage的持久化存储，只能在ui页面使用，且只能存基础类型，复杂类型需要序列化

```tsx
PersistentStorage.persistProp('cityName','河源')
@Entry
@Component
struct AppStoragePage {
  @StorageLink ('cityName')  cityName:string=''
  build() {
    Column() {
      Text(this.cityName)
        .fontSize(35)
        .fontWeight(FontWeight.Bold)
    }
    .height('100%')
    .width('100%')
  }
}
```

## 组件导航

#### 1.使用NavRouter搭配NavDestination

```tsx
interface  ListType{
  name: string
  value: string
}
@Entry
@Component
struct NavigationPage {
  @State permissionList: ListType[] = [
    { name: '设备信息', value: '用于分析设备的续航、通话、上网、SIM卡故障等' },
    { name: '麦克风', value: '用于反馈问题单时增加语音' },
    { name: '存储', value: '用于反馈问题单时增加本地文件附件' }
  ];
  build() {
    Navigation() {
   List(){
     ForEach(this.permissionList,(item:ListType)=>{
       ListItem(){
         NavRouter(){
           Text(item.name)
             .fontSize(24)
             .backgroundColor('#ffdedbdb')
             .borderRadius(20)
             .width('100%')
             .height(35)
             .textAlign(TextAlign.Center)
             .margin({top:10})
           NavDestination(){//路由详情页
             Text(item.value).fontSize(30)
           }
           .title(item.name)
           .hideTitleBar(false)//是否隐藏标题
           .height('100%')
           .backgroundColor(Color.White)
         }
         .padding(10)
       }
     })
   }
    }
    .title('全部笔记')
    .menus([
      {
        value:'',
        icon:"/images/search.svg",
        action:()=>{
          console.log('进入搜索页面')
        }
      }
    ])
    .toolbarConfiguration([//底部导航栏
      {
        value:'QQ',
        icon:'/images/jd_QQ.svg',
        action:()=>{
          console.log('点击qq')
        }
      },
      {
      value:'微博',
      icon:'/images/jd_weibo.svg',
    action:()=>{
      console.log('点击微博')
     }
      }
    ])
    .titleMode(NavigationTitleMode.Full)//标题模式
    .height('100%')
    .width('100%')
  }
}


```

#### 2.NavPathStack搭配NavDestination

```tsx
import { uiObserver } from "@kit.ArkUI"

@Entry
@Component
struct Index {
  @Provide('NavPathStack') pageStack: NavPathStack = new NavPathStack()
  @State listId:number=10
  @Builder
  PagesMap(name: string) {
    if (name == 'DialogPage') {
      DialogPage()
    }
  }

  build() {
    Navigation(this.pageStack) {
      Button('Push DialogPage')
        .margin(20)
        .width('80%')
        .onClick(() => {
          this.pageStack.pushPathByName('DialogPage', this.listId);
        })
    }
    .mode(NavigationMode.Stack)
    .title('Main')
    .navDestination(this.PagesMap)
  }
}

@Component
export struct DialogPage {
  @Consume('NavPathStack') pageStack: NavPathStack;
  build() {
    NavDestination() {
      Stack({ alignContent: Alignment.Center }) {
        Column() {
          Text("Dialog NavDestination")
            .fontSize(20)
            .margin({ bottom: 100 })
          Button("Close").onClick(() => {
            this.pageStack.pop()
          }).width('30%')
        }
        .justifyContent(FlexAlign.Center)
        .backgroundColor(Color.White)
        .borderRadius(10)
        .height('30%')
        .width('80%')
      }.height("100%").width('100%')
    }
    .backgroundColor('rgba(0,0,0,0.5)')
    .hideTitleBar(true)
    .mode(NavDestinationMode.DIALOG)
  }
}
```

## 页面路由

#### 路由跳转

1.pushUrl

```tsx
import { router } from '@kit.ArkUI';
router.pushUrl({
          url:"pages/MusicPage"
    })
```

2.replaceUrl

```tsx
import { router } from '@kit.ArkUI';
router.replaceUrl({
          url:"pages/MusicPage"
    })
```

3.back()

```ts
back(){
  try {
      //确定框提示
    router.showAlertBeforeBackPage({
      message:"确定返回吗",
    })
    router.back({
      url:"pages/RoutePage",
      params:{
        message:'来自detail的消息'
      }
    })
  }
  catch (e){
    console.log(e)
  }
}
```

#### 路由传参

```tsx
传参数
router.pushUrl({
  url:"pages/RoutePage",
  params:{id:12}
},router.RouterMode.Single)

接收参数

interface  paramsData{
  id:number
}

aboutToAppear(): void {
   const data=router.getParams() as paramsData//使用断言
   this.paramsId=data.id
  }
}
```

#### 页面栈

先进后出，最大容量为32个页面

```tsx
router.getLength()//获取页面栈数量

router.clear//清空页面栈
```

#### 路由模式

```tsx
1. Single 页面栈存在目标页面，会将最近的同url页面移至顶部，不新增页面栈
router.pushUrl({
    url:"pages/MusicPage"
  },router.RouterMode.Single)
})

2.Standard,一直添加页面栈
  router.pushUrl({
          url:"pages/MusicPage"
   },router.RouterMode.Standard)
})
```

## 生命周期

<img src="/public//2024-10-30-05.png">

1. 组件Hook

aboutToAppear：创建组件实例后执行，可以修改状态变量

 aboutToDisappear：组件实例销毁前执行，不允许修改状态变量

```tsx
import { router } from '@kit.ArkUI';
//子组件
@Component
struct component {
  @State message: string = 'Hello xxm';
  aboutToAppear(): void {
    console.log('子组件渲染')
  }
  aboutToDisappear(): void {
    console.log('子组件卸载')
  }
  build() {

    Column() {
      Text(this.message)
        .fontSize(35)
        .fontWeight(FontWeight.Bold)
    }
    .height('100%')
    .width('100%')
  }
}

//父组件
@Entry
@Component
struct RouterPage {
  aboutToAppear(): void {
    console.log('父组件渲染')
  }
  aboutToDisappear(): void {
    console.log('父组件卸载')
  }

  build() {
    Column() {
      component()
    }
    .height('100%')
    .width('100%')
  }
}
```

2.页面Hook

 onPageShow：页面每次显示触发（路由过程、应用进入前后台）

 onPageHide：页面每次隐藏触发（路由过程、应用进入前后台）

 onBackPress：点击返回触发（return true 阻止返回键默认返回效果）

```tsx
@Entry
@Component
struct RouterPage {
  onPageShow(): void {
    console.log('页面显式')
  }
  onPageHide(): void {
    console.log('页面隐藏')

  }
  onBackPress(): boolean | void {
    console.log('点击了返回')
    return true//阻止返回
  }
  build() {
    Column() {
      component()
      Button('geTo').onClick(()=>{
        router.pushUrl({
          url:'pages/RoutePage'
        })
      })
    }
    .height('100%')
    .width('100%')
  }
}
```

## Stage模型

##### 全局配置信息

AppScope/app.json5，修改应用管理信息

```tsx
{
  "app": {
    "bundleName": "com.example.myapplication",//包名
    "vendor": "example",//开发厂商描述
    "versionCode": 1000000,//版本号
    "versionName": "1.0.1",//用户显式版本号
    "icon": "$media:wx",//应用图标
    "label": "$string:app_name"//应用名字
  }
}

```

##### 模块配置信息，修改桌面显式图标、名字

main/module.json5

```tsx
"abilities": [
  {
    "name": "EntryAbility",
    "srcEntry": "./ets/entryability/EntryAbility.ets",
    "description": "$string:EntryAbility_desc",
    "icon": "$media:app_icon",//图标
    "label": "$string:EntryAbility_label",//名称
    "startWindowIcon": "$media:startIcon",
    "startWindowBackground": "$color:start_window_background",
    "exported": true,
    "skills": [
      {
        "entities": [
          "entity.system.home"
        ],
        "actions": [
          "action.system.home"
        ]
      }
    ]
  }
],
```

##### Ability

###### 生命周期

```tsx
import { AbilityConstant, UIAbility, Want } from '@kit.AbilityKit';
import { hilog } from '@kit.PerformanceAnalysisKit';
import { window } from '@kit.ArkUI';

export default class EntryAbility extends UIAbility {
  //当Ability创建时
  onCreate(want: Want, launchParam: AbilityConstant.LaunchParam): void {
    hilog.info(0x0000, ' ', '%{public}s', 'Ability onCreate');
  }
  //当Ability销毁时
  onDestroy(): void {
    hilog.info(0x0000, 'testTag', '%{public}s', 'Ability onDestroy');
  }

  onWindowStageCreate(windowStage: window.WindowStage): void {
    // Main window is created, set main page for this ability
    hilog.info(0x0000, 'testTag', '%{public}s', 'Ability onWindowStageCreate');
  //配置首次加载页面调用
    windowStage.loadContent("pages/RouterPage", (err) => {
      if (err.code) {
        hilog.error(0x0000, 'testTag', 'Failed to load the content. Cause: %{public}s', JSON.stringify(err) ?? '');
        return;
      }
      hilog.info(0x0000, 'testTag', 'Succeeded in loading the content.');
    });
  }
//销毁页面调用
  onWindowStageDestroy(): void {
    // Main window is destroyed, release UI related resources
    hilog.info(0x0000, 'testTag', '%{public}s', 'Ability onWindowStageDestroy');
  }
  //当切换前台时
  onForeground(): void {
    // Ability has brought to foreground
    hilog.info(0x0000, 'testTag', '%{public}s', 'Ability onForeground');
  }
  //当切换后台时，到桌面/其他应用
  onBackground(): void {
    // Ability has back to background
    hilog.info(0x0000, 'testTag', '%{public}s', 'Ability onBackground');
  }
}
```

###### 唤起不同Ability

```tsx
1.配置want启动参数
  let wantInfo:Want={
        deviceId:"",//空表示本设备
        bundleName:"com.example.myapplication",//包名
        moduleName:'entry',//模块名
        abilityName:'SecondAbility',//唤起的Ability名
        parameters:{
          name:'xxm from entry',//参数信息
        }
      }
  
  2.使用上下文对象唤起其他Abuility
    context=getContext(this) as common.UIAbilityContext//获取上下文
    
 
 完整代码
import Want from '@ohos.app.ability.Want';
import { common } from '@kit.AbilityKit';
@Entry
@Component
struct RouterPage {
  context=getContext(this) as common.UIAbilityContext//获取上下文对象
  build() {
    Column() {
      Button('geTo').onClick(()=>{
      let wantInfo:Want={
        deviceId:"",//空表示本设备
        bundleName:"com.example.myapplication",//包名
        moduleName:'entry',//模块名
        abilityName:'SecondAbility',//唤起的Ability名
        parameters:{
          name:'xxm from entry',//参数信息
        }
      }
  this.context.startAbility(wantInfo)//唤起其他Abuility
      })
    }
    .height('100%')
    .width('100%')
  }
}
```

###### 跨模块

```tsx
Button('跨模块').onClick(()=>{
  let wantInfo:Want={
    deviceId:"",//空表示本设备
    bundleName:"com.example.myapplication",//包名
    moduleName:'newApplication',//模块名
    abilityName:'NewApplicationAbility',//唤起的Ability名，src/main/module.json5
    parameters:{
      name:'xxm from entry',//参数信息
    }
  }
  this.context.startAbility(wantInfo)
})
```

## 网络请求

设置网络权限 module.json5

```tsx
"requestPermissions": [
  {
    "name": "ohos.permission.INTERNET"//访问网络
  }
],
```

#### 自带http

```tsx
     Button('get').onClick(()=>{
      const httpRequest= http.createHttp()//创建服务
        //发送请求
       httpRequest.request('http://127.0.0.1:3000/rest/banner',{
         method:http.RequestMethod.GET,
         header:{},
         extraData:{},//额外参数
         expectDataType:http.HttpDataType.OBJECT//期待获取数据的格式
       }).then((res)=>{
         console.log(JSON.stringify(res.result['data']))
       })
     })
```

#### ohos/axios

使用第三方库 ohpm install @ohos/axios

##### 基础使用

```tsx
interface  banner{
  data: bannerList[],
  msg: string,
  code: number
}
interface  bannerList{
  id: number,
  url: string,
  alt: string,
  desc: string
}
//发送get请求
axios.get<banner,AxiosResponse<banner>,null('http://localhost:3000/rest/banner').then((res:AxiosResponse<banner>)=>{
 this.bannerList=res.data.data
})
```

##### 封装ohos/axios

```tsx
import axios, { AxiosResponse } from '@ohos/axios'
const request=axios.create({
  baseURL:"http://localhost:3000"
})
interface  optionType{
  method?:string,
  url:string,
  data?:object,
  params?:object,
  header?:object,
}
interface resultType{
  code:number,
  msg:string,
  data:object
}
const http=(option:optionType)=>{
  const method=option.method || 'GET'
  if(method.toUpperCase()==='GET'){
    option.params=option.data
  }
  return request(option)
}
const resultFn=async<T> (option:optionType):Promise<T>=>{
 const result:AxiosResponse<resultType>= await http(option)
  return result.data as T
}
export  default resultFn

使用：
interface  data{
  data: dataLists[],
  msg: string,
  code: number
}
interface  dataLists{
  id: number,
  url: string,
  alt: string,
  desc: string
}
 aboutToAppear(): void {
    resultFn<data>({method:"GET",url:"/rest/banner"}).then((res)=>{
      console.log(JSON.stringify(res))
      this.dataList = res.data;
    })
  }
```

##### 拦截器

```tsx
import axios, {  AxiosError, AxiosResponse, InternalAxiosRequestConfig } from '@ohos/axios'
import promptAction from '@ohos.promptAction';


//创建axios实例
export const instance= axios.create({
  baseURL:'http://2.0.0.1:3000',
  timeout: 5000
})

// 添加请求拦截器
instance.interceptors.request.use((config: InternalAxiosRequestConfig):InternalAxiosRequestConfig => {
  // 通过AppStorage获取token
  const token:string|undefined = AppStorage.get('token')
  if (token) {
    // 若token存在，则将其添加到请求头
    config.headers['token'] = token
  }
  return config;
}, (error: AxiosError) => {
  //若出现异常，则提示异常信息
  promptAction.showToast({ message: error.message })
  return Promise.reject(error);
});

// 添加响应拦截器
// 修改三，使用Promise对异步错误结果进行输出（Promise 对象表示异步操作最终的完成（或失败）以及其结果值。）
instance.interceptors.response.use((response: AxiosResponse):AxiosResponse|Promise<undefined> => {
  // 若服务器返回的是正常数据，不做任何处理
  if (response.data.code === 200) {
    return response
  } else {
    //若服务器返回的是异常数据，则提示异常信息
    promptAction.showToast({ message: response.data.message })
    return Promise.reject(response.data.message)
  }
}, (error: AxiosError) => {
  //若出现异常，则提示异常信息
  promptAction.showToast({ message: error.message })
  return Promise.reject(error);
});
```

#### webSocket

<img src="/public//2024-10-30-04.png">

```tsx
import { webSocket } from '@kit.NetworkKit';
@Entry
@Component
struct WebSocketPage {
  private webSocketImpl?: webSocket.WebSocket | null = null;
  aboutToAppear(): void {
    this.webSocketImpl=webSocket.createWebSocket()//创建连接
    this.webSocketImpl.connect('ws://192.168.75.1:8311')//连接地址
    
    this.webSocketImpl?.on("open",(err,val)=>{//监听open连接方法
    if(!err){
      console.log('连接成功')
    }
    })
  //监听信息
    this.webSocketImpl?.on("message",(err,data)=>{
      if(!err){
        console.log('收到消息'+JSON.stringify(data))
      }
    })
  监听断开
    this.webSocketImpl?.on("close",(err,val)=>{
      if(!err){
        console.log('连接断开')
      }
    })

  }
  build() {
    Column() {
    Button('发送消息').onClick(()=>{
    //调用send发送消息
    this.webSocketImpl?.send('来自客户端的消息')
    })
    }
    .height('100%')
    .width('100%')
  }
}
```

### 多线程

#### TaskPool

```tsx
import { taskpool } from '@kit.ArkTS';
//定义并发函数，会执行一个异步任务，该任务在后台线程中运行并返回结果。
@Concurrent
function  add(num1:number,num2:number){
  return num1+num2
}


Button('执行').onClick(async ()=>{
        try {
          //创建一个新的 taskpool.Task 实例
          let task:taskpool.Task=new taskpool.Task(add,1,2)
          //获取结果
          let res=await taskpool.execute(task)
          console.log(res.toString())
        }catch (e){
          new Error(e)
        }
      })
    }
    .height('100%')
    .width('100%')
  }
}
```

## 文件操作

#### 上传相册图片

```tsx
let photoSelectOptions=new picker.PhotoSelectOptions()//创建图片选择器的配置对象
photoSelectOptions.MIMEType=picker.PhotoViewMIMETypes.IMAGE_TYPE//创建对象类型为图片
photoSelectOptions.maxSelectNumber=1//限制选择文件份数
let photoPicker=new picker.PhotoViewPicker()//创建图片选择器对象
let res=  await photoPicker.select(photoSelectOptions)//获取图片
 this.url=res.photoUris[0]
使用：
Image(this.url)
      .height(100)
      .objectFit(ImageFit.Cover)
```

```tsx
import picker from '@ohos.file.picker'; // 导入文件选择器模块
import fs from '@ohos.file.fs'; // 导入文件系统模块
import request from '@ohos.request'; // 导入网络请求模块

/**
 * 检查应用是否具有读写媒体的权限
 */
async function checkPermissions() {
  const READ_MEDIA_PERMISSION = 'ohos.permission.READ_MEDIA';
  const WRITE_MEDIA_PERMISSION = 'ohos.permission.WRITE_MEDIA';
  let permissions = [READ_MEDIA_PERMISSION, WRITE_MEDIA_PERMISSION];
  for (let permission of permissions) {
    // 检查权限，如果没有则申请权限
    if (!await abilityAccessCtrl.checkPermissions(permission)) {
      await abilityAccessCtrl.applyPermission([permission]);
    }
  }
}

/**
 * 从相册中选择一张图片
 */
async function selectImage() {
  // 创建图片选择器的配置对象
  let photoSelectOptions = new picker.PhotoSelectOptions();
  photoSelectOptions.MIMEType = picker.PhotoViewMIMETypes.IMAGE_TYPE; // 设置选择图片类型
  photoSelectOptions.maxSelectNumber = 1; // 最多选择一张图片

  // 创建图片选择器对象
  let photoViewPicker = new picker.PhotoViewPicker();
  
  // 调用选择方法，用户选择图片
  let result = await photoViewPicker.select(photoSelectOptions);
  
  // 返回选择的图片URI
  return result.photoUris[0];
}

/**
 * 将选中的图片复制到应用的缓存目录
 */
async function copyImageToCache(imageUri) {
  let context = getContext(this); // 获取应用上下文
  let fileType = 'jpg'; // 文件类型
  let fileName = Date.now() + '.' + fileType; // 生成新的文件名
  let cacheDir = context.cacheDir; // 获取缓存目录路径
  let copyFilePath = `${cacheDir}/${fileName}`; // 复制到缓存目录的完整路径

  // 打开文件
  let file = fs.openSync(imageUri, fs.OpenMode.READ_ONLY);
  
  // 将文件复制到缓存目录
  fs.copyFileSync(file.fd, copyFilePath);
  
  // 返回新文件的路径
  return fileName;
}

/**
 * 上传图片到服务器
 */
async function uploadImage(cachedFilePath) {
  let context = getContext(this); // 获取应用上下文
  let uploadConfig = {
    url: '你的上传接口地址', // 服务器接口地址
    method: "POST", // 请求方法
    files: [{
      filename: cachedFilePath, // 文件名
      name: "file", // 文件字段名
      uri: `internal://cache/${cachedFilePath}`, // 文件在设备上的URI
      type: "image/jpeg" // 文件类型
    }]
  };
  
  try {
    // 创建上传任务
    let uploadTask = await request.uploadFile(context, uploadConfig);
    
    // 监听上传进度
    uploadTask.on('progress', (size, total) => {
      console.log(`Uploaded ${size} of ${total}`);
    });
    
    // 监听上传完成
    uploadTask.on('complete', (data) => {
      console.log('Upload complete', data);
    });
    
    // 监听上传失败
    uploadTask.on('fail', (error) => {
      console.error('Upload failed', error);
    });
  } catch (e) {
    console.error('Upload error', e);
  }
}

// 主流程
async function main() {
  await checkPermissions(); // 检查权限
  let imageUri = await selectImage(); // 选择图片
  let cachedFilePath = await copyImageToCache(imageUri); // 复制图片到缓存目录
  await uploadImage(cachedFilePath); // 上传图片
}
```
