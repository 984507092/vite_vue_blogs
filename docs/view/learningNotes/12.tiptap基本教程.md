---
name: é¹¤é¸£
date: 2024-07-29
title: tiptap
---

# TipTap æ•™ç¨‹

## å‰è¨€

å› ä¸ºé¡¹ç›®ä¸­çš„æœ‰ä¸ªéœ€æ±‚éœ€è¦è‡ªå®šä¹‰å·¥å…·æ ï¼Œå½“æ—¶æ‰¾äº†å¥½å¤šå¯Œæ–‡æœ¬ç¼–è¾‘å™¨ï¼Œä½†æ˜¯éƒ½å¤ªå¤æ‚äº†ï¼Œä¹Ÿä¸èƒ½è‡ªå®šä¹‰å¤´çš„å·¥å…·æ ï¼Œæ‰€ä»¥å°±é€‰æ‹©äº†è¿™ä¸ªåº“.

TipTap ä¸€æ¬¾æ”¯æŒ vue2 å’Œ vue3ã€react çš„ç½‘é¡µç¼–è¾‘å™¨ï¼Œç‰¹ç‚¹æ˜¯å¯ä»¥éå¸¸æ–¹ä¾¿çš„è‡ªå®šä¹‰å·¥å…·æ å’Œæ”¯æŒ html å’Œ json æ ¼å¼ï¼Œä½ å®Œå…¨å¯ä»¥æŠŠç¼–è¾‘å™¨ UI è®¾è®¡æˆä½ éœ€è¦çš„ç•Œé¢ï¼Œç»™æˆ‘ä¸ªäººçš„æ„Ÿè§‰ TipTap æ˜¯ä»‹äº markdown ä¸ html ä¹‹é—´çš„ä¸€ç§ç¼–è¾‘å™¨å¾ˆçµæ´»ã€‚

[TipTap](https://tiptap.dev/) æ˜¯ä¸€ä¸ªåŸºäº ProseMirror çš„å¯Œæ–‡æœ¬ç¼–è¾‘å™¨ã€‚

## TipTap ç½‘ç«™åœ°å€

### å®˜æ–¹æ–‡æ¡£

<https://tiptap.dev>

### è‹±æ–‡æ–‡æ¡£

<https://tiptap.dev/docs/editor/extensions/custom-extensions/node-views/vue>

### ä¸­æ–‡æ–‡æ¡£

<https://www.itxst.com/tiptap/customextensions.html>

### github åœ°å€

<https://github.com/ueberdosis/tiptap/blob/main/packages/vue-2/src/VueNodeViewRenderer.ts>

### æµ‹è¯•åœ°å€

<https://debug.itxst.com/static/tiptapdemo/index.html#blockquote>

## TipTap æ¦‚å¿µ

- æ— å·¥å…·æ  è½»é‡åŒ–é»˜è®¤ä¸è‡ªå¸¦å·¥å…·æ ï¼Œå¯æ‰©å±•æ€§å¼ºå’Œç®€æ´

- ååŒ æ”¯æŒhtmlå’Œjsonï¼Œjsonæ ¼å¼ä½ å¯ä»¥åœ¨å…¶ä»–ç«¯ï¼ˆå®‰å“ã€IOSç­‰ï¼‰å®ç°ç¼–è¾‘å’Œæµè§ˆ

- extension å¼€ç®±å³ç”¨çš„ extension æ‰©å±•æ’ä»¶ï¼Œæ¯”å¦‚æ–‡å­—é¢œè‰²æ‰©å±•ã€è¡¨æ ¼æ‰©å±•

## å®‰è£… tiptap

```bash
// vue2 å®‰è£…
npm install @tiptap/vue-2 @tiptap/pm @tiptap/starter-kit
// vue3 å®‰è£…
npm install @tiptap/vue-3 @tiptap/pm @tiptap/starter-kit
// react å®‰è£…
npm install @tiptap/react @tiptap/pm @tiptap/starter-kit
// nuxt.js å®‰è£…
npm install @tiptap/vue-2 @tiptap/pm @tiptap/starter-kit
```

## é…ç½®ç¼–è¾‘å™¨

### index.vue

```vue
<template>
  <div class="input-container">
    <editor-content class="editor-content" v-if="editor" :editor="editor" />
  </div>
</template>

<script>
import { Editor, EditorContent } from '@tiptap/vue-2'
import config from './index.config'
import { uploadFiles } from '@/api/groupCode'
export default {
  components: {
    EditorContent,
  },
  props: {
    value: {
      type: String,
      default: '',
    },
  },

  data() {
    return {
      editor: null,
    }
  },

  watch: {
    value: {
      deep: true,
      handler(value) {
        // JSON
        // const isSame = JSON.stringify(this.editor.getJSON()) === JSON.stringify(value)
        // HTML
        const isSame = this.editor.getHTML() === value
        if (isSame) {
          return
        }
        this.editor.commands.setContent(value, false, {
          preserveWhitespace: 'full',
        })
      },
    },
  },

  mounted() {
    this.init()
  },
  methods: {
    init() {
      this.editor = new Editor({
        extensions: config,
        content: this.value,
        autofocus: 'end',
        onUpdate: (e) => {
          // HTML
          this.$emit('input', this.editor.getHTML())
          // JSON
          // this.$emit('input', this.editor.getJSON())
        },
        editorProps: {
          attributes: {
            class: 'editor-input',
          },
          handlePaste: this.handlePaste,
        },
      })
    },
    replaceFragment(html) {
      return html.replace(/<!--StartFragment-->|<!--EndFragment-->/g, '')
    },
    replaceTextTags(htmlString) {
      // å®šä¹‰æ­£åˆ™è¡¨è¾¾å¼ï¼ŒåŒ¹é…å¸¸è§çš„æ–‡æœ¬ç±»æ ‡ç­¾(é™¤äº† < p > æ ‡ç­¾)
      const pattern = /<\/?(b|strong|i|em|u|mark|small|del|ins|sub|sup)>/g
      // ä½¿ç”¨ replace è¿›è¡Œæ™®æ¢ï¼Œå°†åŒ¹é…çš„æ ‡ç­¾æ›¿æ¢ä¸º<span>
      const replacedHtml = htmlString.replace(pattern, '<span>')
      return replacedHtml
    },
    // ç²˜è´´äº‹ä»¶
    handlePaste(view, event, slice) {
      // é¦–å…ˆè·å–ç²˜è´´æ¿çš„æ•°æ®
      const clipboardData = event.clipboardData
      // è·å–ç²˜è´´æ¿ä¸­çš„æ‰€æœ‰é¡¹ç›®
      const items = clipboardData.items
      for (let i = 0; i < items.length; i++) {
        if (items[i].type.indexOf('text') !== -1) {
          const html = event.clipboardData.getData('text/html') // è·å–ç²˜è´´çš„ html
          // const text = event.clipboardData.getData('text/plain') // è·å–ç²˜è´´çš„çº¯æ–‡æœ¬
          // const rtf = event.clipboardData.getData('text/rtf') // è·å– rtf æ•°æ®ï¼ˆå¦‚ä» word wsp å¤åˆ¶ç²˜è´´ï¼‰
          let parser = new DOMParser()
          if (html) {
            event.preventDefault() // é˜»æ­¢é»˜è®¤çš„ç²˜è´´è¡Œä¸º
            let doc = parser.parseFromString(html, 'text/html')
            let elementsWithStyle = doc.querySelectorAll('[class]')
            elementsWithStyle.forEach((element) => {
              element.removeAttribute('class')
              // element.removeAttribute('style')
            })
            let updateHtml = this.replaceTextTags(this.replaceFragment(doc.body.innerHTML))
            console.log("ğŸš€ ~ handlePaste ~ updateHtml:", updateHtml)
            this.editor.commands.setContent(updateHtml)
          }

          // items[i].getAsString((str) => {
          //   this.editor.commands.insertContent(str)
          //   event.preventDefault() // é˜»æ­¢é»˜è®¤çš„ç²˜è´´è¡Œä¸º
          // })
          return true
        }
        // æ£€æŸ¥é¡¹ç›®çš„ç±»å‹æ˜¯å¦ä¸ºå›¾ç‰‡
        else if (items[i].type.indexOf('image') !== -1) {
          const file = items[i].getAsFile()
          // å‡è®¾æ‚¨è¦å°†å›¾ç‰‡ä¸Šä¼ åˆ°æœåŠ¡å™¨
          // åˆ›å»ºä¸€ä¸ªæ–°çš„ FormData å¯¹è±¡
          let formData = new FormData()
          // å°†å›¾ç‰‡æ–‡ä»¶æ·»åŠ åˆ° FormData ä¸­
          formData.append('file', file)
          formData.append('prefixUrl', 'certification')
          uploadFiles(formData).then((res) => {
            if (res.code === 1) {
              this.$message.success('ä¸Šä¼ æˆåŠŸ')
              this.editor.commands.setImage({ src: res.data[0].absoluteUrl })
            } else {
              this.$message.error('ä¸Šä¼ å¤±è´¥')
            }
          })
          return false
        }
      }
      return false
    },
  },

  beforeDestroy() {
    this.editor.destroy()
  },
}
</script>
<style scoped>
.input-container {
  width: 100%;
  height: 100%;
  min-height: 190px;
  max-height: 326px;
  overflow-x: hidden;
  border: 1px solid #e9e9e9;
}

.editor-content {
  width: 100%;
  height: 100%;
  min-height: 190px;
  max-height: 326px;
  /* white-space: pre-wrap;  ä¿æŒç©ºæ ¼å’Œæ¢è¡Œç¬¦ */
}

/* å¯Œæ–‡æœ¬æ ·å¼ */
.editor-input {
  width: 100%;
  height: 100%;
  min-height: 190px;
  max-height: 326px;
  overflow: auto;
  font-size: 14px;
  padding: 10px;
  box-sizing: border-box;
  /* white-space: pre-wrap;  ä¿æŒç©ºæ ¼å’Œæ¢è¡Œç¬¦  */
}

.editor-input p {
  margin: 5px 0;
  font-size: 14px;
  color: #666;
  background: #fff;
  word-break: break-all;
  /* white-space: pre-wrap;  ä¿æŒç©ºæ ¼å’Œæ¢è¡Œç¬¦  */
}

/* å»æ‰èšç„¦é»‘è¾¹ */
.ProseMirror-focused {
  outline: unset;
}

.ProseMirror-selectednode {
  outline: 1px solid #3e86ff;
}

.ProseMirror p.is-editor-empty:first-child::before {
  color: #adb5bd;
  content: attr(data-placeholder);
  float: left;
  height: 0;
  font-size: 14px;
  pointer-events: none;
}

img {
  max-width: 160px;
  max-height: 160px;
  cursor: pointer;
  border-radius: 5px;
  vertical-align: middle;
}

.my-custom-class {
  max-width: 160px;
  max-height: 160px;
}
</style>
```

### index.config.js

```js
// tiptap çš„æ‰©å±•
import StarterKit from '@tiptap/starter-kit' // æ ¸å¿ƒèŠ‚ç‚¹
import Placeholder from '@tiptap/extension-placeholder' // å ä½ç¬¦
import Document from '@tiptap/extension-document' // æ–‡æ¡£èŠ‚ç‚¹
import Paragraph from '@tiptap/extension-paragraph' // æ®µè½èŠ‚ç‚¹
import Text from '@tiptap/extension-text' // æ–‡æœ¬èŠ‚ç‚¹
import Dropcursor from '@tiptap/extension-dropcursor' // æ‹–åŠ¨å…‰æ ‡æ‰©å±•
import Typography from '@tiptap/extension-typography' //  ç‰¹æ®Šç¬¦å·
import Image from '@tiptap/extension-image' // å›¾ç‰‡æ‰©å±•
import Heading from '@tiptap/extension-heading' // æ ‡é¢˜
import HardBreak from '@tiptap/extension-hard-break' // æ¢è¡Œ
import Italic from '@tiptap/extension-italic' // æ–œä½“
import Highlight from '@tiptap/extension-highlight' // é«˜äº®æ ‡è®°
import Code from '@tiptap/extension-code' // Code æ ‡ç­¾
import Bold from '@tiptap/extension-bold' //ç²—ä½“
import Strike from '@tiptap/extension-strike' // åˆ é™¤ç¬¦
import Underline from '@tiptap/extension-underline' // ä¸‹åˆ’çº¿
import Superscript from '@tiptap/extension-superscript' //ä¸Šæ ‡
import Subscript from '@tiptap/extension-subscript' //ä¸‹æ ‡
import TextStyle from '@tiptap/extension-text-style' // æ–‡æœ¬æ ·å¼

// è‡ªå®šä¹‰æ‰©å±•
import CustomTag from './components/Tag/index'


/**
 * @description  æœªä¸‹åŒ…çš„æ‰©å±•
 *  import Link from '@tiptap/extension-link' // è¶…é“¾æ¥
 *  import TextAlign from '@tiptap/extension-text-align' // å¯¹é½æ–¹å¼
 *  import Focus from '@tiptap/extension-focus' // ç„¦ç‚¹æ‰©å±•
 *  import FloatingMenu from '@tiptap/extension-floating-menu'//  æµ®åŠ¨èœå•
 *  import CharacterCount from '@tiptap/extension-character-count' //  æ–‡å­—ç»Ÿè®¡
 *  import BubbleMenu from '@tiptap/extension-bubble-menu' // æ°”æ³¡èœå•
 *  import { Color } from '@tiptap/extension-color' // é¢œè‰²æ‰©å±•
*/


export default [
  StarterKit,
  Document,
  Text,
  Typography,
  Dropcursor,
  HardBreak,
  Bold,
  Code,
  Italic,
  Strike,
  Subscript,
  TextStyle,
  Underline,
  Superscript,
  CustomTag,
  Highlight.configure({ multicolor: true }),
  Paragraph.configure({
    HTMLAttributes: {
      class: 'custom-class'
    }
  }),
  // Link.configure({
  //   openOnClick: false,
  // }),
  Placeholder.configure({
    placeholder: 'è¯·è¾“å…¥æ–‡å­—ï¼Œæ”¯æŒç²˜è´´å›¾ç‰‡'
  }),
  Heading.configure({
    levels: [1, 2, 3, 4, 5, 6],
  }),
  Image.configure({
    inline: true,
    HTMLAttributes: {
      class: 'my-custom-class'
    }
  })
]


```

### è‡ªå®šä¹‰æ ‡ç­¾

```vue
<template>
  <node-view-wrapper class="custom-tag" :class="node.attrs.class">
    <span>&nbsp;</span>
    <el-tag closable size="small" @close="handleClose">{{node.attrs.label}}</el-tag>
    <span>&nbsp;</span>
  </node-view-wrapper>
</template>

<script>
import { NodeViewWrapper } from '@tiptap/vue-2'
export default {
  components: {
    NodeViewWrapper
  },
  props: {
    // the editor instance
    editor: {
      type: Object
    },

    // the current node
    node: {
      type: Object
    },

    // an array of decorations
    decorations: {
      type: Array
    },

    // å½“å‰èŠ‚ç‚¹è§†å›¾å­˜åœ¨â€œNodeSelectionâ€æ—¶ä¸ºtrue
    selected: {
      type: Boolean
    },

    // è®¿é—®èŠ‚ç‚¹æ‰©å±•ï¼Œä¾‹å¦‚è·å–é€‰é¡¹
    extension: {
      type: Object
    },

    //è·å–å½“å‰èŠ‚ç‚¹çš„æ–‡æ¡£ä½ç½®
    getPos: {
      type: Function
    },

    // update attributes of the current node
    updateAttributes: {
      type: Function
    },

    // delete the current node
    deleteNode: {
      type: Function
    }
  },
  data() {
    return {
      data: {}
    }
  },
  mounted() {},
  methods: {
    handleClose() {
      this.deleteNode()
    }
  }
}
</script>
<style lang='scss' scoped>
.custom-tag {
  display: inline-block;
}
</style>

```

``` js
import { mergeAttributes, Node } from '@tiptap/core'
import { VueNodeViewRenderer } from '@tiptap/vue-2'
import TagView from './customTag.vue'


const CustomTag = Node.create({
  name: 'custom-tag',
  group: 'inline',
  inline: true,
  atom: true,
  addAttributes() {
    return {
      label: {
        default: ''
      },
      class: {
        default: 'custom-tag'
      }
    }
  },
  parseHTML() {
    return [
      {
        tag: 'custom-tag'
      }
    ]
  },
  renderHTML({ HTMLAttributes }) {
    return ['custom-tag', mergeAttributes(HTMLAttributes)]
  },
  addNodeView() {
    return VueNodeViewRenderer(TagView)
  }
})

export default CustomTag

```

### æœ€åä½¿ç”¨

```vue
<template>
  <div class="text-editor">
    <div class="text-editor-toolbar">
      <el-popover placement="bottom" trigger="click" v-model="showDialog">
        <div slot="reference" class="emoji_btn">
          <img
            src="https://yizhen-mamapai-dev.oss-cn-zhangjiakou.aliyuncs.com/certification/2024-07-22/1492fc2a085647859eef0b9ccdf783df.png"
            alt
          />
        </div>
        <VEmojiPicker
          v-show="true"
          :style="{ width:'100%'}"
          :showSearch="false"
          lang="pt-BR"
          @select="selectEmoji"
        ></VEmojiPicker>
      </el-popover>
      <el-button size="small" class="nickname_btn" @click="handleAddNickName">æ˜µç§°</el-button>
      <div class="text-editor-toolbar-right" @click="handleCopyText">
        <el-button type="text">å¤åˆ¶</el-button>
      </div>
    </div>
    <TipTapEditor ref="tipTapEditor" v-model="content" @input="handleInputEditor"></TipTapEditor>

    <div class="copy_text" ref="copyText">{{content}}</div>
  </div>
</template>

<script>
import TipTapEditor from '@/components/TipTapEditor/index.vue'
import { VEmojiPicker } from 'v-emoji-picker'
import { oneClickCopy } from '@/utils/utils'
export default {
  components: {
    TipTapEditor,
    VEmojiPicker
  },
  model: {
    prop: 'contentValue',
    event: 'input'
  },
  props: {
    contentValue: {
      type: String,
      default: ''
    },
    isDialogVisible: {
      type: Boolean,
      default: false
    }
  },
  data() {
    return {
      content: '',
      showDialog: false
    }
  },
  watch: {
    isDialogVisible: {
      immediate: true,
      deep: true,
      handler(newVal) {
        if (newVal && this.contentValue) {
          // this.showDialog = false;
          this.content = this.contentValue
           this.contentCopyText = this.contentValue.replace(/<br\s*\/?>/g, '\n')
        }
      }
    }
  },
  mounted() {},
  methods: {
    handleInputEditor(e) {
       this.contentCopyText = e
        .split('</p>')
        .filter(i => i)
        .map(i => i.replace('<p class="custom-class">', '') + '<br/>')
        .join('')
        .replaceAll(',', '')
        .replace(/<br\s*\/?>/g, '\n')
        .trimEnd()
      this.$emit('input', e)
    },

    handleAddNickName() {
      let tag = {
        type: 'custom-tag',
        attrs: {
          label: 'æ˜µç§°'
        }
      }
      this.handleInsertContent(tag)
      this.$emit('add-nickname', this.content)
      // this.$refs.tipTapEditor.editor.commands.insertContent(tag)
    },

    handleEmoji() {
      this.showDialog = true
    },

    // å°† v-emoji-picker ä¸­é€‰æ‹©çš„è¡¨æƒ…æ·»åŠ åˆ°å†…å®¹ä¸­
    selectEmoji(emoji) {
      this.handleInsertContent(emoji.data)
      this.$emit('insert-emoji', this.content)
      this.showDialog = false
      // this.$refs.tipTapEditor.editor.commands.insertContent(emoji.data)
    },

    handleCopyText() {
      setTimeout(() => {
        const copyTextRef = this.$refs.copyText
        let res = oneClickCopy(copyTextRef)
        if (res) {
          this.$message.success('å¤åˆ¶æˆåŠŸ')
        } else {
          this.$message.error('å¤åˆ¶å¤±è´¥')
        }
      })
    },

    // clearContent  æ¸…é™¤å†…å®¹
    handleClearContent(update = false) {
      //ç§»é™¤ç¼–è¾‘å™¨æ–‡æ¡£å†…å®¹ï¼Œå¹¶è§¦å‘ update äº‹ä»¶
      this.$refs.tipTapEditor.editor.commands.clearContent(update)
      this.content = ''
    },

    /**
     *  @description {insertContent}  æ’å…¥å†…å®¹
     *  @description {isSpace} æ’å…¥å­—ç¬¦ä¸²å»é™¤ä¸¤è¾¹ç©ºæ ¼
     */
    handleInsertContent(content, isSpace = false) {
      this.$refs.tipTapEditor.editor.commands.insertContent(content, {
        parseOptions: {
          preserveWhitespace: isSpace
        }
      })
    }
  }
}
</script>
<style lang='scss' scoped>
img {
  width: 100%;
  height: 100%;
  display: block;
}
.text-editor {
  max-width: 560px;
  min-width: 150px;
  background: #ffffff;
  // height: 285px;
  // border: 1px solid #e5e5e5;
  margin: 0px auto 0;
  position: relative;

  .text-editor-toolbar {
    position: relative;
    display: flex;
    align-items: center;
    grid-gap: 8px;
    gap: 8px;
    padding: 8px 18px;
    line-height: 1 !important;
    border: 1px solid #e9e9e9;
    border-bottom: none;
    background: #f9f9f9;

    .emoji_btn {
      width: 24px;
      height: 24px;
      cursor: pointer;
    }

    .nickname_btn {
      background: #fff;
      border: 1px solid #e9e9e9;
      padding: 5px 8px;
      cursor: pointer;
      margin: 0;
      border-radius: 2px;
      color: #666;
      font-size: 14px;
    }

    .text-editor-toolbar-right {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
      display: flex;
      align-items: center;
      margin-right: 16px;
      font-size: 14px;
    }
  }
}

.emoji_picker {
  // position: absolute;
  // top: 0px;
  // left: -200px;
  width: 100%;
}

.copy_text {
  position: absolute;
  top: -9999px;
  left: -9999px;
  z-index: 0;
}

.custom-view-tag {
  display: inline-block;
}
</style>

```

æ ¹æ®ä¸Šé¢çš„ä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œåœ¨tiptapä¸­ï¼Œæˆ‘ä»¬ç±»ä¼¼äºæŒ‰éœ€å¼•å…¥çš„æ–¹å¼å’Œè‡ªå®šä¹‰çš„æ–¹å¼æ¥è®¾ç½®å·¥å…·æ ï¼Œä¸Šé¢çš„ä»£ç æ˜¯ vue2 çš„æ¡ˆä¾‹ï¼Œ

æˆ‘åœ¨å†™é¡¹ç›®çš„æ—¶å€™ï¼Œå› ä¸ºé¡¹ç›®åè€æ‰€ä»¥å†™çš„æ—¶å€™ï¼Œè¸©äº†å¾ˆå¤šçš„å‘ï¼Œå¦‚æœè¯´åœ¨è€é¡¹ç›®ä¸­ï¼Œvue2ä¸­çš„ babel-loader ç‰ˆæœ¬æ¯”è¾ƒä½ï¼Œä¼šå‡ºç°å¾ˆå¤šé—®çš„é—®é¢˜ï¼Œæˆ‘é‡åˆ°çš„é—®é¢˜æ˜¯æ²¡æœ‰åœ¨ babel-loader ä¸­é…ç½®

 ```js
     {
      test: /\.js$/,
      loader: 'babel-loader',
      include: [
        resolve('src'),
        resolve('test'),
        resolve('node_modules/@tiptap'),
        resolve('node_modules/webpack-dev-server/client'),
      ]
    },
 ```

 è‡´ vue2 ä¸­çš„æŠ¥é”™ï¼Œå¦å¤–æˆ‘è¿˜é‡åˆ°äº†ç²˜è´´è‡ªå®šä¹‰æŒ‡ä»¤æ— æ³•è¯†åˆ«å’Œå¤„ç†ç²˜è´´å›¾ç‰‡çš„é—®é¢˜ï¼Œå…·ä½“ä»£ç å¦‚ä¸‹

 ```js
     replaceFragment(html) {
      return html.replace(/<!--StartFragment-->|<!--EndFragment-->/g, '')
    },
    replaceTextTags(htmlString) {
      // å®šä¹‰æ­£åˆ™è¡¨è¾¾å¼ï¼ŒåŒ¹é…å¸¸è§çš„æ–‡æœ¬ç±»æ ‡ç­¾(é™¤äº† < p > æ ‡ç­¾)
      const pattern = /<\/?(b|strong|i|em|u|mark|small|del|ins|sub|sup)>/g
      // ä½¿ç”¨ replace è¿›è¡Œæ™®æ¢ï¼Œå°†åŒ¹é…çš„æ ‡ç­¾æ›¿æ¢ä¸º<span>
      const replacedHtml = htmlString.replace(pattern, '<span>')
      return replacedHtml
    },
    // ç²˜è´´äº‹ä»¶
    handlePaste(view, event, slice) {
      // é¦–å…ˆè·å–ç²˜è´´æ¿çš„æ•°æ®
      const clipboardData = event.clipboardData
      // è·å–ç²˜è´´æ¿ä¸­çš„æ‰€æœ‰é¡¹ç›®
      const items = clipboardData.items
      for (let i = 0; i < items.length; i++) {
        if (items[i].type.indexOf('text') !== -1) {
          // https://www.wangeditor.com/v5/editor-config.html#custompaste
          const html = event.clipboardData.getData('text/html') // è·å–ç²˜è´´çš„ html
          // const text = event.clipboardData.getData('text/plain') // è·å–ç²˜è´´çš„çº¯æ–‡æœ¬
          // const rtf = event.clipboardData.getData('text/rtf') // è·å– rtf æ•°æ®ï¼ˆå¦‚ä» word wsp å¤åˆ¶ç²˜è´´ï¼‰
          let parser = new DOMParser()
          if (html) {
            event.preventDefault() // é˜»æ­¢é»˜è®¤çš„ç²˜è´´è¡Œä¸º
            let doc = parser.parseFromString(html, 'text/html')
            let elementsWithStyle = doc.querySelectorAll('[class]')
            elementsWithStyle.forEach((element) => {
              element.removeAttribute('class')
            //element.removeAttribute('style')
            })
            let updateHtml = this.replaceTextTags(this.replaceFragment(doc.body.innerHTML))
            console.log("ğŸš€ ~ handlePaste ~ updateHtml:", updateHtml)
            this.editor.commands.setContent(updateHtml)
          }

          // items[i].getAsString((str) => {
          //   this.editor.commands.insertContent(str)
          //   event.preventDefault() // é˜»æ­¢é»˜è®¤çš„ç²˜è´´è¡Œä¸º
          // })
          return true
        }
        // æ£€æŸ¥é¡¹ç›®çš„ç±»å‹æ˜¯å¦ä¸ºå›¾ç‰‡
        else if (items[i].type.indexOf('image') !== -1) {
          const file = items[i].getAsFile()
          // å‡è®¾æ‚¨è¦å°†å›¾ç‰‡ä¸Šä¼ åˆ°æœåŠ¡å™¨
          // åˆ›å»ºä¸€ä¸ªæ–°çš„ FormData å¯¹è±¡
          let formData = new FormData()
          // å°†å›¾ç‰‡æ–‡ä»¶æ·»åŠ åˆ° FormData ä¸­
          formData.append('file', file)
          formData.append('prefixUrl', 'certification')
          uploadFiles(formData).then((res) => {
            if (res.code === 1) {
              this.$message.success('ä¸Šä¼ æˆåŠŸ')
              this.editor.commands.setImage({ src: res.data[0].absoluteUrl })
            } else {
              this.$message.error('ä¸Šä¼ å¤±è´¥')
            }
          })
          return false
        }
      }
      return false
    }
 ```

## TipTap Pro ä»‹ç»

æ­¤å¤–ï¼ŒTipTap è¿˜æœ‰ Pro ç‰ˆæœ¬çš„æ’ä»¶ï¼Œä½†æ˜¯ä½¿ç”¨ Pro çš„æ’ä»¶éœ€è¦å…ˆæ³¨å†Œè´¦å·ï¼Œç„¶åæ‰èƒ½ä½¿ç”¨ï¼Œå…·ä½“å¯ä»¥å‚è€ƒå®˜ç½‘ï¼Œè¿™é‡Œå¤§è‡´è®°å½•ä¸€ä¸‹ï¼Œå› ä¸ºå®˜ç½‘æ˜¯è‹±æ–‡ï¼Œé˜…è¯»èµ·æ¥å…¶å®æ¯”è¾ƒå›°éš¾ï¼Œæˆ‘è¿™é‡Œå°±ç®€å•çš„è¯´ä¸€ä¸‹åº”è¯¥æ€ä¹ˆä½¿ç”¨

é¦–å…ˆæˆ‘ä»¬æ³¨å†Œä¸€ä¸ª TipTap  çš„è´¦å·ï¼Œç„¶åç™»å½•ï¼Œç™»å½•æˆåŠŸåä½ ä¼šçœ‹åˆ°ä¸€ä¸ª tokenï¼Œè¿™ä¸ªtokenå°±æ˜¯æˆ‘ä»¬éœ€è¦çš„

åœ¨æ˜¯ç”¨è¿™ä¸ª token çš„æ—¶å€™æˆ‘ä»¬éœ€è¦åœ¨é¡¹ç›® npmrc ä¸­é…ç½®ï¼Œå¦‚æœæ˜¯ yarn çš„è¯å°±é…ç½® yarnrc ,ç„¶åç²˜è´´

```js
  @tiptap-pro:registry=https://registry.tiptap.dev/
  //registry.tiptap.dev/:_authToken=${token}
```

`npm install --save @tiptap-pro/extension-unique-id` è¿™ä¸ªæ˜¯é¡¹ç›®ä¸­çš„è‡ªå®šä¹‰ç»„ä»¶åŠ ä¸Šå”¯ä¸€idï¼Œå…·ä½“å¯ä»¥å‚è€ƒå®˜ç½‘

`npm install @tiptap-pro/extension-emoji` è¿™ä¸ªæ˜¯æ ‡ç­¾çš„æ’ä»¶ï¼Œå…·ä½“å¯ä»¥å‚è€ƒå®˜ç½‘

ä¸ºäº†æ­£ç¡®æ”¾ç½®å¼¹å‡ºæ¡†ï¼Œå®˜æ–¹åœ¨æ‰€æœ‰ç¤ºä¾‹ä¸­éƒ½ä½¿ç”¨tippy.jsã€‚ä½ å¯ä»¥è‡ªç”±æºå¸¦ä½ è‡ªå·±çš„åº“ï¼Œä½†æ˜¯å¦‚æœä½ ä¸ä»‹æ„çš„è¯ï¼Œå°±å®‰è£…æˆ‘ä»¬ä½¿ç”¨çš„å§:
`npm install tippy.js`

å› ä¸ºæˆ‘çš„é¡¹ç›®ä¸­åªç”¨åˆ°äº†ä¸€éƒ¨åˆ†è¿™é‡Œä¸å¤šè§£é‡Šäº†ï¼Œå…·ä½“çš„å¯ä»¥çœ‹å®˜ç½‘

é™¤äº†éœ€è¦ç”¨åˆ°é«˜é˜¶çš„ Pro çš„æ’ä»¶ï¼ŒåŸºæœ¬ä¸Šæ™®é€šçš„éƒ½èƒ½æå®šï¼Œä¸€èˆ¬æœ‰é—®é¢˜ä»€ä¹ˆçš„éƒ½æ˜¯é¡¹ç›®å¤ªè€çš„åŸå› ï¼ˆæˆ‘ä¼°è®¡æ˜¯è¿™æ ·ï¼‰ï¼Œå› ä¸ºæˆ‘è¯•äº†ï¼Œå‡ ä¸ªé¡¹ç›® vue2 åˆ° vue3 éƒ½æ²¡ä»€ä¹ˆé—®é¢˜ç”¨èµ·æ¥å°±æ˜¯å‚»ç“œå¼æ“ä½œï¼ŒæŒ‰ç…§æ–‡æ¡£èµ°å°±è¡Œäº†ï¼Œé¡¹ç›®å¤ªè€å°±ä¼šå¾ˆå¤šé—®é¢˜

å¾ˆå¤šå…·ä½“çš„é—®é¢˜è¿˜æ˜¯è¦å»çœ‹å®˜æ–¹æ–‡æ¡£ï¼Œä¸ªäººè‹±æ–‡ç”¨é™ï¼Œå¯èƒ½åˆä¸å¯¹çš„åœ°æ–¹.
